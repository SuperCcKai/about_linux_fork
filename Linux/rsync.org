# -*- coding:utf-8 -*-
#+LANGUAGE:  zh
#+TITLE:     rsync.org
#+AUTHOR:    纪秀峰
#+EMAIL:     jixiuf@gmail.com
#+DATE:     2012-11-01 四
#+DESCRIPTION:rsync.org
#+KEYWORDS:
#+OPTIONS:   H:2 num:nil toc:t \n:t @:t ::t |:t ^:nil -:t f:t *:t <:t
#+OPTIONS:   TeX:t LaTeX:t skip:nil d:nil todo:t pri:nil
#+FILETAGS:@Linux

rsyncd.conf
#+BEGIN_SRC sh
 # /etc/rsyncd.conf

 # Minimal configuration file for rsync daemon
 # See rsync(1) and rsyncd.conf(5) man pages for help

 # This line is required by the /etc/init.d/rsyncd script
 pid file = /var/run/rsyncd.pid
 use chroot = yes
 read only = yes

 [sql_remote]
 	path = /tmp/sql_remote
     read only = no
     write only= yes
     auth users= root jixiuf
     secrets file=/etc/rsyncd_pass.conf
     strict modes=no
 	comment = sql remote
     uid=0
     gid=0
 	# exclude = /distfiles /packages

 # Simple example for enabling your own local rsync server
 #[gentoo-portage]
 #	path = /usr/portage
 #	comment = Gentoo Portage tree
 #	exclude = /distfiles /packages
#+END_SRC
/etc/rsyncd_pass.conf
#+BEGIN_SRC sh
jixiuf:jixiuf
root:root
#+END_SRC
#+BEGIN_SRC sh
rsync  -ahqzt  /home/jixiuf/Linux-C.pdf jixiuf@127.0.0.1::sql_remote  --password-file=/home/jixiuf/passwd
-a 存档模式
-h 保存硬连接
-q 制止非错误信息
-z 压缩文件数据在传输
-t 维护修改时间
-delete 删除于多余文件
#+END_SRC
#+BEGIN_SRC sh
cat /home/jixiuf/passwd
jixiuf
#+END_SRC
inotify监控目录 inotify-tools
#+BEGIN_SRC sh
 #/bin/sh
 # REMOTE_IP=192.168.1.202
 REMOTE_IP=127.0.0.1
 # 以下目录要以 /结尾,
 REMOTE_DEST_DIR=/tmp/
 LOCAL_SRC_DIR=/home/jixiuf/lszm2/server/game_server/sql_dest/
 USER_NAME=jixiuf
 PASSWORD_FILE=/home/jixiuf/passwd
 # --password-file=FILE
 # DST=rsync@$REMOTE_IP:$REMOTE_DEST_DIR
 DST=rsync://$USER_NAME@$REMOTE_IP::sql_remote
 # rsync /home/jixiuf/notes.org $REMOTE_IP::$REMOTE_DIR
 exit_status=$?
 echo $exit_status

 # DST=rsync@192.168.10.4:/home/rsync/test

 # -a 存档模式
 # -h 保存硬连接
 # -q 制止非错误信息
 # -z 压缩文件数据在传输
 # -t 维护修改时间
 # -delete 删除于多余文件
 inotifywait -mrq -e modify,create ${LOCAL_SRC_DIR} | while read D E F
 do
     echo $F
     echo $DST
 	rsync  -ahqzt   $LOCAL_SRC_DIR $DST
 done
 # --password-file=$PASSWORD_FILE
#+END_SRC


#+BEGIN_SRC sh
/usr/local/bin/inotifywait -mrq -e modify,delete,create,attrib ${src}
-m 是保持一直监听
-r 是递归查看目录
-q 是打印出事件
#+END_SRC
