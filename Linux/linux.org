# -*- coding:utf-8-unix -*-
#+LANGUAGE:  zh
#+TITLE:     linux拾遗
#+AUTHOR:    纪秀峰
#+EMAIL:     jixiuf@gmail.com
#+DATE:     2013-02-17 日
#+DESCRIPTION:linux拾遗
#+KEYWORDS: @Linux
#+OPTIONS:   H:2 num:nil toc:t \n:t @:t ::t |:t ^:nil -:t f:t *:t <:t
#+OPTIONS:   TeX:t LaTeX:t skip:nil d:nil todo:t pri:nil
#+FILETAGS: @Linux
* 几个工具
- nload 查看网卡流量
- nethugs 查看具体的进程发包收包情况
- rkhunter linux 安全工具，扫描后门程序（需要刚装机时建立样本进行对比)
- lsof -i:8888  查看兼听8888端口的程序
- top 按M按内存排序
- tmux
  tmux attach
  C-bd  退出
  C-b0 C-b1 C-b2  切tag
  C-bs list sessions
  C-bn C-bp next prev
  C-bc 新建tag
* 使某一目录下创建的所有文件目录的groupname 都是 当前用户所属的组
  #+BEGIN_SRC sh
    chmod g+s dir1
  #+END_SRC
  dir1以下的FILE和FOLDER组名都是当前用户所属的组
* umask
  umask就是指定“当前用户在建立文件或目录时候的属性默认值”
  对于文件来说，这一数字的最大值分别是6。
  目录则允许设置执行权限，这样针对目录来说，umask中各个数字最大可以到7。
  我们只要记住u m a s k是从权限中“拿走”相应的位即可。
  如：umask值为022，则默认目录权限为755，默认文件权限为644。
  对于组权限，setfacl设置的权限只对主组（即useradd -g或usermod -g的组）
  有效，对附加组（即useradd -G或usermod -aG的组）无效，即使文件的所有组已改为附加组。
* setfacl
  /etc/fstab 里加 acl 选项
  #+BEGIN_QUOTE
   /dev/sda2		/		ext3		noatime,acl		0 1
  #+END_QUOTE
  mount -o remount /
#+BEGIN_SRC sh
  给某个用户设置权限：
  setfacl -m u:joe:rx bobdir/
  给某个组设置权限：
  setfacl -m g:aclgp1:rx bobdir/
  取消某项权限
  setfacl -x g:aclgp1 bobdir/
#+END_SRC
#+BEGIN_SRC sh
  setfacl命令可以识别以下的规则格式。

  [d[efault]:] [u[ser]:]uid [:perms]
  指定用户的权限，文件所有者的权限（如果uid没有指定）。

  [d[efault]:] g[roup]:gid [:perms]
  指定群组的权限，文件所有群组的权限（如果gid未指定）

  [d[efault]:] m[ask][:] [:perms]
  有效权限掩码

  [d[efault]:] o[ther] [:perms]
#+END_SRC
#+BEGIN_SRC sh
  setfacl -m d:g:groupA:rwx /path/to/perms

  The -m flag stands for "Modify" the existing ACL. The little d in front of g
  makes it a "Default" ACL, so that in future if any file/dir gets created under
  perms directory, groupA will have rwx permission on them too.
#+END_SRC
* mbr and dd

MBR=主引导区记录。硬盘的0磁道的第一个扇区称为MBR，它的大小是512字节，而这个区域
可以分为三个部分。第一部分为pre-boot区（预启动区），占446字节；第二部分是
Partition table区（分区表），占64个字节，硬盘中分区有多少以及每一分区的大小都记
在其中。第三部分是magic number，占2个字节，固定为55AA。MBR是针对整个硬盘而言的，
而引导扇区是对单个分区而言的。每个分区的第一扇区就是引导扇区：像MBR一样，引导扇
区里包含了一些引导操作系统所需要的相关信息。如果引导扇区被破坏了是个非常严重的
问题，那就意味着这个分区不能被访问，安装在这个分区上的操作系统也不能被启动。所
以说修复引导是使得每一个分区都能被正确识别引导。

#+srcname: 备份与还原mbr信息
#+begin_src sh
  446+64+2=512
  dd </dev/sda bs=512 count=1 >mbr512.img
  dd <mbr512.img bs=446 count=1 >/dev/sda
  dd <mbr512.img bs=1 count=64 skip=446 seek=446 >/dev/sda
#+end_src
* ctags
  http://blog.csdn.net/moiyer/article/details/5438962
* nmap
*** IP
  ip 地址范围 192.168.1.0/24
  192.168.1.1-254
*** Port
    指定端口 : -p80 -p1-1024

*** -s 开头的 表示扫描
    | -sT | 扫描Tcp连接 |
    | -sU | 扫描Udp连接 |
    | -sP | Ping扫描    |
    |     |             |
    扫描tcp连接
    nmap -sT 192.168.1.101
* linux下分辨率调整
  http://blog.csdn.net/wangfaqiang/article/details/6289959
  #+BEGIN_SRC sh
我的理解就是，长1440 宽900,深75
root@jf /home/jixiuf # cvt 1440 900 75
生成 Modeline这一行
# 1440x900 74.98 Hz (CVT 1.30MA) hsync: 70.64 kHz; pclk: 136.75 MHz
Modeline "1440x900_75.00"  136.75  1440 1536 1688 1936  900 903 909 942 -hsync +vsync
  #+END_SRC
  然后，配成这面的样子，即可
  #+BEGIN_QUOTE
  Section "Monitor"
  Identifier      "Configured Monitor"
  Modeline "1440x900_75.00"  136.75  1440 1536 1688 1936  900 903 909 942 -hsync +vsync
  Option          "PreferredMode" "1440x900_75.00"
  EndSection

  Section "Screen"
  Identifier      "Default Screen"
  Monitor         "Configured Monitor"
  Device          "Configured Video Device"
  EndSection

  Section "Device"
  Identifier "Configured Video Device"
  EndSection
  #+END_QUOTE
* 通过ssh 连接远程机器上的mysql 等
  通常的情况是远程 42.62.14.55 上有一个mysql ,兼听在3306端口上
  但是防火墙阻止直接连3306端口
  解决加法是 ssh 连上42.62.14.55 ,然后在ssh 访问mysql 3306端口，
  此时防问
  ssh -L 3307:localhost:3306 username@42.62.14.55 -N
   # ssh -L <localport>hostname<remoteport> <username>@<servername>
  这个时候在你的本机会开一个3307端口
  然后 mysql -uroot -ppass -P3307 就可以连上这个mysql了
* ssh socat
  我局域网ip 是192.168.1网段的

  10.142.8.24 是位于另一网段的一台内网机器　,
  122.224.249.55 是一台有公网ip的机器，
  10.142.8.24位于122.224.249.55后面
  也就是说要想ssh连接到10.142.8.24需要途经 122.224.249.55
  用到了socat这款软件做代理
  使用如下命令,
  本机ip: 192.168.1.127

  防火墙 122.224.249.55 port 9991
  内网机　10.142.8.24 ssh 端口开在36000上

  sudo ssh -o ProxyCommand='socat - socks:122.224.249.55:%h:%p,socksport=9991' username@10.142.8.24 -p 36000
  没加 sudo 之前一直给我提示Permission denied (keyboard-interactive),不知原因何
  在，难道socat命令需要root权限
* sed 一些用法
  1. 最常见的 sed 's/old/new/g' filename
  2. 提取匹配的某一部分
     比如文件有有一行内容如下,我想取出其中的数字部分
         AC_PREREQ(2.65)
     autoconf_min=`sed -n 's/^ *AC_PREREQ(\([0-9\.]*\)).*/\1/p' configure.ac`
     其中 \1  引用 \([0-9\.]*\) 匹配的部分
     常用到从某文件中取版本号等





