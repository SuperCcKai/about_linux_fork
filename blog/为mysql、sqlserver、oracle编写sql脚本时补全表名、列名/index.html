<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>为mysql、sqlserver、oracle编写sql脚本时补全表名、列名 - 一个人的狂欢</title>
    <meta charset="utf-8" />
    <meta name="author" content="纪秀峰" />
    <meta name="description" content="为mysql及oracle编写sql脚本时补全表名、列名" />
    <meta name="keywords" content="emacs sql mysql oracle complete anything" />
    <link rel="stylesheet" href="/media/css/main.css" type="text/css">
    <link rel="stylesheet" href="/media/css/prettify.css" type="text/css">
  </head>
  <body class="container">
    <div>
      <header class="masthead">
        <h1 class="masthead-title"><a href="/">一个人的狂欢</a></h1>
        <p></p>
        <ul>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/tags/">Tags</a></li>
          <li><a href="/about/">About</a></li>
          <li><a href="http://github.com/jixiuf">GitHub</a></li>
          <li><a href="/rss.xml">RSS</a></li>
        </ul>
        <form method="get" id="searchform" action="http://www.google.com/search">
          <input type="text" class="field" name="q" id="s" placeholder="Search">
          <input type="hidden" name="as_sitesearch" value="jixiuf.github.io">
        </form>
      </header>
    </div>

<div>
<div class="post">
<h1>为mysql、sqlserver、oracle编写sql脚本时补全表名、列名</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline1">链接</a></li>
<li><a href="#orgheadline2">简介</a></li>
<li><a href="#orgheadline3">如何使用进行mysql 的表名列名补全：</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1">链接</h2>
<div class="outline-text-2" id="text-orgheadline1">
<p>
演示视频screencast <a href="http://screencast-repos.googlecode.com/files/emacs-sqlparse-mysql-complete.mkv.bz2">screencast</a> mkv格式 ，用bzip 进行压缩<br  />
文件上传到了 <a href="http://emacswiki.org/Joseph">http://emacswiki.org/Joseph</a>,<br  />
同时源代码用git 进行管理，地址在这里<a href="https://github.com/jixiuf/sqlparser">github.com/sqlparser</a>.<br  />
</p>
</div>
</div>
<div id="outline-container-orgheadline2" class="outline-2">
<h2 id="orgheadline2">简介</h2>
<div class="outline-text-2" id="text-orgheadline2">
<p>
最近新写了一个以mysql 为后端，当编写sql 脚本时，能适时地从mysql 数据库中查询<br  />
适时插入到当前光标下的表名列名等内容的扩展. 即进行表名列名的补全。(现在也相应<br  />
的提供了 oracle sqlserver 版本的)<br  />
emacswiki上有<a href="http://www.emacswiki.org/emacs/SqlComplete">SqlComplete</a> 的介绍，用了一下，发现并不好用。不够智能，比如它不<br  />
清楚什么时候该插入表名，什么时候该插入列名。所以只好自已动手。<br  />
</p>

<p>
相初用这个sqlparser名字是因为 在emacs 中对sql 语句进行编写时，想写一些解析当前sql<br  />
语句的相关函数，所以用了sqlparser这个名，后来陆续添加了一些与sql相关的功能<br  />
用这个名字，似乎不太合适，但也懒得改了。<br  />
</p>
<ul class="org-ul">
<li>oracle-query.el<br  /></li>
<li>sqlserver-query.el<br  /></li>
<li>mysql-query.el<br  />
这三个提供最基本的连接数据库的功能<br  /></li>

<li>sqlparser-mysql-complete.el<br  /></li>
<li>sqlparser-oracle-complete.el<br  /></li>
<li>sqlparser-sqlserver-complete.el<br  />
这三个文件 分别提供编写 sql脚本时补全 表名、列名的功能。<br  />
比如在from 之后，补全表名，在select ,where 之后补全列名等.<br  /></li>

<li>sqlserver-table2entity-4csharp.el<br  /></li>
<li>sqlserver-table2entity-4java.el<br  /></li>
<li>oracle-table2entity-4csharp.el<br  /></li>
<li>oracle-table2entity-4java.el<br  /></li>
<li>mysql-table2entity-4csharp.el<br  /></li>
<li>mysql-table2entity-4java.el<br  /></li>
<li><p>
mysql-table2record-erlang.el<br  />
这几个文件分别提供了将sqlserver mysql oracle的某个schema中所有的表导出成java<br  />
csharp 实体类的功能。<br  />
</p>
<div class="org-src-container">

<pre class="src src-sh">M-x: sqlserver-table2entity-4csharp-interactively
M-x: sqlserver-table2entity-4java-interactively
M-x: oracle-table2entity-4java-interactively
M-x: oracle-table2entity-4csharp-interactively
M-x: mysql-table2entity-4csharp-interactively
M-x: mysql-table2entity-4java-interactively
M-x: erlang-mysql-generate-records
</pre>
</div>
<p>
分别提供这样几个函数<br  />
</p>
<ul class="org-ul">
<li><p>
mysql-query.el<br  />
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">;; the normal way to use mysql-query.el is :
;; 1:
(defvar mysql-connection (mysql-query-create-connection connection-info))
or
(defvar mysql-connection nil)
(unless (mysql-query-connection-alive-p  mysql-connection)
  (setq mysql-connection (call-interactively 'mysql-query-create-connection)))

;; 2:
  (mysql-query              "select user from mysql.user" mysql-connection)
  (mysql-query-with-heading "select user from mysql.user" mysql-connection)
</pre>
</div></li>
<li><p>
oracle-query.el<br  />
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">;; execute sql using sqlplus and return as list .
(oracle-query "select empno,ename from emp where empno&lt;=7499")
;; got :     (("7369" "SMITH") ("7499" "ALLEN"))
;; or
(oracle-query-with-heading "select empno,ename from emp where empno&lt;=7499")
;; got :     (("EMPNO" "ENAME") ("7369" "SMITH") ("7499" "ALLEN"))
;; using default connection ,not recommended.
(defvar connection (oracle-query-create-connection "scott/tiger"))
(oracle-query "select empno from emp" connection)
;; recommended
;; the normal way to use oracle-query.el is :
;; 1:
(defvar sqlplus-connection nil)
(unless (oracle-query-connection-alive-p c)
  (setq sqlplus-connection (call-interactively 'oracle-query-create-connection)))
;; 2:
(oracle-query "select empno from emp" sqlplus-connection)
;; 3:
(oracle-query-close-connection sqlplus-connection)
</pre>
</div></li>
<li><p>
sqlserver-query.el<br  />
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">  ;; the normal way to use sqlserver-query.el is :
;; 1:
(defvar c nil)
(unless (sqlserver-query-connection-alive-p c)
  (setq c (call-interactively 'sqlserver-query-create-connection)))
;; 2:
  (sqlserver-query "select empno from emp" c)
  ;; or
  (sqlserver-query-with-heading "select empno from emp" c)
;; 3:
  (sqlserver-query-close-connection c)
</pre>
</div></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline3" class="outline-2">
<h2 id="orgheadline3">如何使用进行mysql 的表名列名补全：</h2>
<div class="outline-text-2" id="text-orgheadline3">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(require 'sqlparser-mysql-complete)
(define-key sql-mode-map (quote [M-return]) 'sqlparser-mysql-complete)
(define-key sql-interactive-mode-map  (quote [M-return]) 'sqlparser-mysql-complete)
;; or
(defadvice sql-mysql (around start-mysql-complete-minor-mode activate)
  "enable `mysql-complete-minor-mode' minor mode."
  ad-do-it
  (mysql-complete-minor-mode))
(define-derived-mode mysql-mode sql-mode "mysql"
  "mysql mode"
  (mysql-complete-minor-mode))

;; `sqlparser-mysql-complete' default  bind on `TAB' in
;; with `C-u' you can change the dbname
;; with `C-uC-u' you can use another new mysql connection
</pre>
</div>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(require 'sqlparser-oracle-complete)
(add-hook 'sql-mode-hook 'oracle-complete-minor-mode)
(add-hook 'sqlplus-mode-hook 'oracle-complete-minor-mode)
;; or you can call M-x: oracle-complete-minor-mode
;; and complete command is binded on `TAB' .
;; with `C-u' you can complete with new connection string.
</pre>
</div>
<div class="org-src-container">

<pre class="src src-emacs-lisp"> ;; there is a minor mode defined here
      (sqlserver-complete-minor-mode)
;; you can add it to sql-mode-hook
(add-hook  'sql-mode-hook 'sqlserver-complete-minor-mode)
;; or call M-x sqlserver-complete-minor-mode

 ;; and complete command is binded on `TAB' .

;; 1. you should custom these variable
;; `sqlserver-connection-info'
 ;; `sqlserver-cmd' ;sqlcmd or osql
;; for example
(setq sqlserver-connection-info
      '((username . "sa")
        (password . "sa")
        (server-instance . "localhost\\SQLEXPRESS")
        (dbname . "master"))
      )
;; or sometimes
(setq sqlserver-connection-info
      '((username . "sa")
        (password . "sa")
        (server-instance . "localhost")
        (dbname . "master")))

(setq sqlserver-cmd' 'sqlcmd) or (setq sqlserver-cmd' 'osql)


;; my config file about sqlserver-complete-minor-mode looks like this .
(require 'sql)
(require 'sqlparser-sqlserver-complete)
(add-hook  'sql-mode-hook 'sqlserver-complete-minor-mode)
(add-hook  'sqlserver-complete-minor-mode-hook 'sqlserver-complete-minor-mode-setup)
(defun sqlserver-complete-minor-mode-setup()
  (setq sqlserver-connection-info
    '((username . "sa")
      (password . "sa")
      (server-instance . "localhost")
      (dbname . "HAIHUA"))
    )
  (setq sqlserver-cmd 'sqlcmd)
  )
</pre>
</div>
</div>
</div>

</div>
</div>
    <div>
      <div class="post-meta">
        <span title="post date" class="post-info">2011-07-21</span>
        <span title="last modification date" class="post-info">2016-01-14</span>
        <span title="tags" class="post-info"><a href="/tags/emacs/">Emacs</a>, <a href="/tags/sql/">SQL</a></span>
        <span title="author" class="post-info">纪秀峰</span>
      </div>
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          //var disqus_developer = 1;
          var disqus_identifier = "/blog/为mysql、sqlserver、oracle编写sql脚本时补全表名、列名/";
          var disqus_url = "http://jixiuf.github.io/blog/为mysql、sqlserver、oracle编写sql脚本时补全表名、列名/";
          var disqus_shortname = 'jixiuf';
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        <div class="ds-thread"></div>
        <script type="text/javascript">
          var duoshuoQuery = {short_name:'jixiuf'};
          (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = 'http://static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
          || document.getElementsByTagName('body')[0]).appendChild(ds);
          })();
        </script>
      </section>
      <script src="http://code.jquery.com/jquery-latest.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="/media/js/main.js"></script>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.x (<a href="http://orgmode.org">Org mode</a> 8.x)</p>
        <p>
          Copyright &copy; 2012 - <span id="footerYear"></span> <a href="mailto:jixiuf &lt;at&gt; gmail &lt;dot&gt; com">纪秀峰</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/kelvinh/org-page" target="_blank">org-page</a>
          <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
      </div>
    </div>

  </body>
</html>
