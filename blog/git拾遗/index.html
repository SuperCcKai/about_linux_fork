<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>git拾遗 - 一个人的狂欢</title>
    <meta charset="utf-8" />
    <meta name="author" content="纪秀峰" />
    <meta name="description" content="git拾遗" />
    <meta name="keywords" content="git scm" />
    <link rel="stylesheet" href="/media/css/main.css" type="text/css">
    <link rel="stylesheet" href="/media/css/prettify.css" type="text/css">
  </head>
  <body class="container">
    <div>
      <header class="masthead">
        <h1 class="masthead-title"><a href="/">一个人的狂欢</a></h1>
        <p></p>
        <ul>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/tags/">Tags</a></li>
          <li><a href="/about/">About</a></li>
          <li><a href="http://github.com/jixiuf">GitHub</a></li>
          <li><a href="/rss.xml">RSS</a></li>
        </ul>
        <form method="get" id="searchform" action="http://www.google.com/search">
          <input type="text" class="field" name="q" id="s" placeholder="Search">
          <input type="hidden" name="as_sitesearch" value="jixiuf.github.io">
        </form>
      </header>
    </div>

<div>
<div class="post">
<h1>git拾遗</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline1">git rm</a></li>
<li><a href="#orgheadline2">在一个旧库中 建一个新分支（新分支上无任何内容）</a></li>
<li><a href="#orgheadline3">git submodule 子模块的删除</a></li>
<li><a href="#orgheadline4">要查看某个文件的以前的版本,使用 git show 命令</a></li>
<li><a href="#orgheadline5">可以checkout 某个文件的以前的版本</a></li>
<li><a href="#orgheadline6">git ls-tree 与git show</a></li>
<li><a href="#orgheadline7">git svn</a>
<ul>
<li><a href="#orgheadline8">svn 的远程分支叫 remotes/git-svn</a></li>
<li><a href="#orgheadline9">git reset version</a></li>
</ul>
</li>
<li><a href="#orgheadline10">找回丢失的提交</a></li>
<li><a href="#orgheadline11">找回库中删除的文件</a>
<ul>
<li><a href="#orgheadline12">grep 历史提交中的内容</a></li>
</ul>
</li>
<li><a href="#orgheadline13">关于换行符 空格</a>
<ul>
<li><a href="#orgheadline14">git config &#x2013;global core.whitespace cr-at-eol</a></li>
<li><a href="#orgheadline15">如果很多文件包含 ^M 这个字符想把它去掉 (未测试 )</a></li>
</ul>
</li>
<li><a href="#orgheadline16">总有一些修改的文件你不想提交,比如 连接db的配置文件,你只是想在本机做测试而做的小修改</a></li>
<li><a href="#orgheadline23">关于修改已经提交的信息 git filter-branch</a>
<ul>
<li><a href="#orgheadline17">查找中文件中包含"密码"二字的文件列出来</a></li>
<li><a href="#orgheadline18">修改历史提交信息</a></li>
<li><a href="#orgheadline19">删除敏感文件</a></li>
<li><a href="#orgheadline20">修改 commiter 的 name 和 email，</a></li>
<li><a href="#orgheadline21">把项目中的某个目录当作git 的新的根目录 ,除此目录中的文件都删掉</a></li>
<li><a href="#orgheadline22">删除两次提交之间的提交log,但是提交的内容还在库里并没有丢失</a></li>
</ul>
</li>
<li><a href="#orgheadline24">Links</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1">git rm</h2>
<div class="outline-text-2" id="text-orgheadline1">
<div class="org-src-container">

<pre class="src src-sh">git rm --cache filename
</pre>
</div>
<p>
从库中删除filename ,即不再对它进行管理， 但本地会留一份.<br  />
</p>
</div>
</div>
<div id="outline-container-orgheadline2" class="outline-2">
<h2 id="orgheadline2">在一个旧库中 建一个新分支（新分支上无任何内容）</h2>
<div class="outline-text-2" id="text-orgheadline2">
<p>
git checkout &#x2013;orphan gh-pages<br  />
git rm -rf .<br  />
</p>
</div>
</div>

<div id="outline-container-orgheadline3" class="outline-2">
<h2 id="orgheadline3">git submodule 子模块的删除</h2>
<div class="outline-text-2" id="text-orgheadline3">
<p>
需要3步<br  />
</p>
<ul class="org-ul">
<li><p>
修改 .gitmodules 文件，删除相应的条目<br  />
</p>
<div class="org-src-container">

<pre class="src src-sh">[submodule "site-lisp/anything-config"]
path = site-lisp/anything-config
url = http://repo.or.cz/r/anything-config.git
</pre>
</div></li>
<li><p>
修改.git/config 文件，删除相应的条目<br  />
</p>
<div class="org-src-container">

<pre class="src src-sh">[submodule "site-lisp/anything-config"]
    url = http://repo.or.cz/r/anything-config.git
</pre>
</div></li>
<li><p>
运行git rm &#x2013;cache 子模块所在路径,如:<br  />
</p>
<div class="org-src-container">

<pre class="src src-sh">git rm --cache site-lisp/anything-config
</pre>
</div>
<p>
不能写成<br  />
</p>
<div class="org-src-container">

<pre class="src src-sh">git rm --cache site-lisp/anything-config/
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-2">
<h2 id="orgheadline4">要查看某个文件的以前的版本,使用 git show 命令</h2>
<div class="outline-text-2" id="text-orgheadline4">
<div class="org-src-container">

<pre class="src src-sh">git show 0b26bbe907c929ed88f6ba3dfeaaa9a2953b1c56:a.txt

git cat-file blob 0b26bbe907c929ed88f6ba3dfeaaa9a2953b1c56:a.txt
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-2">
<h2 id="orgheadline5">可以checkout 某个文件的以前的版本</h2>
<div class="outline-text-2" id="text-orgheadline5">
<div class="org-src-container">

<pre class="src src-sh">git checkout 0b26bbe907c929ed88f6ba3dfeaaa9a2953b1c56 a.txt
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline6" class="outline-2">
<h2 id="orgheadline6">git ls-tree 与git show</h2>
<div class="outline-text-2" id="text-orgheadline6">
<p>
 不仅仅一次提交后会产生一个sha1 的字符串,其实每一个提交对应的文件也后有一个状态,比后我想杳看<br  />
0b26bbe907c929ed88f6ba3dfeaaa9a2953b1c56这次提交后对应的文件所对应的sha1值<br  />
可以使用git ls-tree命令<br  />
比如<br  />
</p>
<div class="org-src-container">

<pre class="src src-sh">root # git ls-tree f7619cab6a71505b23e172f3146adfa750bab71e
100644 blob 83c4ba189edcc364ca18b0b7d2cd81655d97adc5    a
100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391    d
</pre>
</div>
<p>
比如此次提交后文件a与d 分别对应的sha1 值列了出来,然后就可以直接用这个值去查看相应的文件<br  />
</p>
<div class="org-src-container">

<pre class="src src-sh">git show 83c4ba189edcc364ca18b0b7d2cd81655d97adc5 后查看文件a的内容
</pre>
</div>
<div class="org-src-container">

<pre class="src src-sh">这与
git show f7619cab6a71505b23e172f3146adfa750bab71e:a     的效果相同
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline7" class="outline-2">
<h2 id="orgheadline7">git svn</h2>
<div class="outline-text-2" id="text-orgheadline7">
<p>
git svn clone svn-url <code>= git clone git-url
  git svn  fetch =</code> git pull<br  />
git svn  rebase <code>= git rebase
  git svn dcommit =</code> git push<br  />
在运行git svn dcommit 时，必须保证本地没有已修改但未commit 的文件，<br  />
解决方法是<br  />
git stash<br  />
git svn dcommit<br  />
git stash pop<br  />
一般做法是<br  />
git stash<br  />
git svn fetch<br  />
git svn rebase<br  />
git svn dcommit<br  />
git stash pop<br  />
</p>
</div>
<div id="outline-container-orgheadline8" class="outline-3">
<h3 id="orgheadline8">svn 的远程分支叫 remotes/git-svn</h3>
<div class="outline-text-3" id="text-orgheadline8">
<p>
如果在当前分支已经有数次提交 ，但是发现有一个bug需要修复，修复后马上提交 ，而<br  />
  当前分支里的commit 并不想push到远程svn上，做法是<br  />
  git co remotes/git-svn -b tmp<br  />
  然后修复bug 提交 即可，当然其中可以使用stash 来暂时保存未commit 的修改<br  />
</p>
</div>
</div>
<div id="outline-container-orgheadline9" class="outline-3">
<h3 id="orgheadline9">git reset version</h3>
<div class="outline-text-3" id="text-orgheadline9">
<p>
合并commit 。想将最后几次commit 合并成一个commit<br  />
可以用 git reset version<br  />
git reset 回退到某一版本后，<br  />
工作区的文件依然保存着未回退前的状态 ，所以只需再提交一次<br  />
即将最后几次的commit 合并到一次提交<br  />
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline10" class="outline-2">
<h2 id="orgheadline10">找回丢失的提交</h2>
<div class="outline-text-2" id="text-orgheadline10">
<p>
在使用Git的过程中，有时可能会有一些误操作<br  />
比如：执行checkout -f 或 reset -hard 或 branch -d删除一个分支<br  />
结果造成本地（远程）的分支或某些commit丢失<br  />
这时，我们可以通过reflog来进行恢复，前提是丢失的分支或commit信息没有被<br  />
git gc清除<br  />
一般情况下，gc对那些无用的object会保留很长时间后才清除的<br  />
reflog是git提供的一个内部工具，用于记录对git仓库进行的各种操作<br  />
可以使用git reflog show或git log -g命令来看到所有的操作日志<br  />
恢复的过程很简单：<br  />
</p>
<ol class="org-ol">
<li>通过git log -g命令来找到我们需要恢复的信息对应的commitid，可以通过提<br  />
交的时间和日期来辨别<br  /></li>
<li>通过git branch recover<sub>branch</sub> commitid 来建立一个新的分支<br  />
这样，我们就把丢失的东西给恢复到了recover<sub>branch分支上了</sub><br  /></li>
<li>在magit 中`lh'即要吧列出所有的commit<br  /></li>
</ol>
</div>
</div>
<div id="outline-container-orgheadline11" class="outline-2">
<h2 id="orgheadline11">找回库中删除的文件</h2>
<div class="outline-text-2" id="text-orgheadline11">
<ol class="org-ol">
<li>找回库中不再管理的已删除文件(之前git rm 过且git commit 后的文件)<br  />
git log &#x2013;all &#x2013;pretty=format: &#x2013;name-only &#x2013;diff-filter=D |grep -v "^$"<br  />
grep -v 过滤不包含空的行<br  /></li>
<li>列出  rm 过， 但未git rm 过的文件<br  />
git ls-files &#x2013;deleted<br  /></li>
<li>列出git rm过，但未git commit 的<br  />
用git status即可<br  /></li>
</ol>
</div>
<div id="outline-container-orgheadline12" class="outline-3">
<h3 id="orgheadline12">grep 历史提交中的内容</h3>
<div class="outline-text-3" id="text-orgheadline12">
<p>
git grep hello<br  />
但是如果某文件被删了， 不会grep之<br  />
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline13" class="outline-2">
<h2 id="orgheadline13">关于换行符 空格</h2>
<div class="outline-text-2" id="text-orgheadline13">
<p>
Github suggests that you should make sure to only use \n as a newline<br  />
character in git-handled repos. There's an option to auto-convert:<br  />
$ git config &#x2013;global core.autocrlf true<br  />
Of course, this is said to convert crlf to lf.<br  />
</p>
</div>

<div id="outline-container-orgheadline14" class="outline-3">
<h3 id="orgheadline14">git config &#x2013;global core.whitespace cr-at-eol</h3>
<div class="outline-text-3" id="text-orgheadline14">
<p>
This basically tells Git that an end-of-line CR is not an error. As a<br  />
result, those annoying ^M characters no longer appear at the end of lines<br  />
in git diff, git show, etc.<br  />
</p>
</div>
</div>

<div id="outline-container-orgheadline15" class="outline-3">
<h3 id="orgheadline15">如果很多文件包含 ^M 这个字符想把它去掉 (未测试 )</h3>
<div class="outline-text-3" id="text-orgheadline15">
<div class="org-src-container">

<pre class="src src-sh">  # Remove everything from the index
$ git rm --cached -r .
# Re-add all the deleted files to the index
# You should get lots of messages like: "warning: CRLF will be replaced by LF in &lt;file&gt;."
$ git diff --cached --name-only -z | xargs -0 git add
# Commit
$ git commit -m "Fix CRLF"
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline16" class="outline-2">
<h2 id="orgheadline16">总有一些修改的文件你不想提交,比如 连接db的配置文件,你只是想在本机做测试而做的小修改</h2>
<div class="outline-text-2" id="text-orgheadline16">
<p>
GIT: ignoring changes in tracked files<br  />
</p>
<div class="org-src-container">

<pre class="src src-sh">git update-index --assume-unchanged &lt;file&gt;
</pre>
</div>
<div class="org-src-container">

<pre class="src src-sh">恢复则为
git update-index --no-assume-unchanged &lt;file&gt;
</pre>
</div>
<div class="org-src-container">

<pre class="src src-sh">查看有哪些这样的文件
  git ls-files -v|grep '^h'
</pre>
</div>
<div class="org-src-container">

<pre class="src src-sh">在~/.gitconfig 以方便使用
[alias]
      ignore = !git update-index --assume-unchanged
      unignore = !git update-index --no-assume-unchanged
      ignored = !git ls-files -v | grep ^[a-z]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline23" class="outline-2">
<h2 id="orgheadline23">关于修改已经提交的信息 git filter-branch</h2>
<div class="outline-text-2" id="text-orgheadline23">
</div><div id="outline-container-orgheadline17" class="outline-3">
<h3 id="orgheadline17">查找中文件中包含"密码"二字的文件列出来</h3>
<div class="outline-text-3" id="text-orgheadline17">
<p>
&#x2013;stat告诉 git 我希望看到文件列表，以确定敏感数据在哪个文件里<br  />
</p>
<div class="org-src-container">

<pre class="src src-sh">git log --stat -S密码
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline18" class="outline-3">
<h3 id="orgheadline18">修改历史提交信息</h3>
<div class="outline-text-3" id="text-orgheadline18">
<div class="org-src-container">

<pre class="src src-sh">将提交信息中所有oldpass替换为newpasswd
git filter-branch --msg-filter  'sed s/oldpass/newpasswd/' -f HEAD --all
删除log中所有"git-svn-id:"
git filter-branch --msg-filter 'sed -e "/^git-svn-id:/d"'
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline19" class="outline-3">
<h3 id="orgheadline19">删除敏感文件</h3>
<div class="outline-text-3" id="text-orgheadline19">
<div class="org-src-container">

<pre class="src src-sh">git filter-branch --tree-filter 'rm -rf files_to_remove' --prune-empty -f HEAD --all
或者(较快)
git filter-branch -f --index-filter 'git rm --cached --ignore-unmatch  filename' --prune-empty HEAD
</pre>
</div>
<p>
&#x2013;tree-filter表示修改文件列表。<br  />
&#x2013;msg-filter表示修改提交信息，原提交信息从标准输入读入，新提交信息输出到标准输出。<br  />
&#x2013;prune-empty表示如果修改后的提交为空则扔掉不要。在一次试运行中我发现虽然文件被删除了，但是还剩下个空的提交，就查了下 man 文档，找到了这个选项。<br  />
-f是忽略备份。不加这个选项第二次运行这个命令时会出错，意思是 git 上次做了备份，现在再要运行的话得处理掉上次的备份。<br  />
&#x2013;all是针对所有的分支。<br  />
</p>
</div>
</div>

<div id="outline-container-orgheadline20" class="outline-3">
<h3 id="orgheadline20">修改 commiter 的 name 和 email，</h3>
<div class="outline-text-3" id="text-orgheadline20">
<div class="org-src-container">

<pre class="src src-sh">git filter-branch -f --env-filter "GIT_AUTHOR_NAME='Newname'; GIT_AUTHOR_EMAIL='newemail'; GIT_COMMITTER_NAME='Newname'; GIT_COMMITTER_EMAIL='newemail';" HEAD
</pre>
</div>
<p>
需要注意的是git filter-branch 会修改大量的sha1值,git push 时,可能会冲突,要想好<br  />
怎样处理好这个问题.<br  />
</p>
</div>
</div>
<div id="outline-container-orgheadline21" class="outline-3">
<h3 id="orgheadline21">把项目中的某个目录当作git 的新的根目录 ,除此目录中的文件都删掉</h3>
<div class="outline-text-3" id="text-orgheadline21">
<p>
相当于用某个子目录建一个新的git的仓库,不过,要注意,其他的文件都会被删了,<br  />
注意备份仓库<br  />
</p>
<div class="org-src-container">

<pre class="src src-sh">git filter-branch --subdirectory-filter w32 -- --all
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline22" class="outline-3">
<h3 id="orgheadline22">删除两次提交之间的提交log,但是提交的内容还在库里并没有丢失</h3>
<div class="outline-text-3" id="text-orgheadline22">
<p>
作用仅仅相当于合并了n次提交成为一次提交<br  />
之前<br  />
</p>
<blockquote>
<ul class="org-ul">
<li>(HEAD, master)f5b0f0b..: jixiuf 2013-01-11 4<br  /></li>
<li>22715cb..: jixiuf 2013-01-11 3<br  /></li>
<li>169849d..: jixiuf 2013-01-11 2<br  /></li>
</ul>
</blockquote>
<div class="org-src-container">

<pre class="src src-sh">删除169849d与f5b0f0b之间的commit
echo "f5b0f0bab898d4021dad6c87bfad0140dfb5bb23 169849d727285e6d3b1ff7536a2d22033d2b8b10" &gt;&gt; .git/info/grafts
git filter-branch 169849d727285e6d3b1ff7536a2d22033d2b8b10..HEAD
</pre>
</div>
<p>
之后<br  />
</p>
<blockquote>
<ul class="org-ul">
<li>(HEAD, master)60b2c23..: jixiuf 2013-01-11 4<br  /></li>
<li>169849d..: jixiuf 2013-01-11 2<br  /></li>
</ul>
</blockquote>
</div>
</div>
</div>
<div id="outline-container-orgheadline24" class="outline-2">
<h2 id="orgheadline24">Links</h2>
<div class="outline-text-2" id="text-orgheadline24">
<p>
很多git的小技巧<br  />
<a href="http://gitready.com/">http://gitready.com/</a><br  />
</p>
</div>
</div>

</div>
</div>
    <div>
      <div class="post-meta">
        <span title="post date" class="post-info">2011-08-09</span>
        <span title="last modification date" class="post-info">2016-01-14</span>
        <span title="tags" class="post-info"><a href="/tags/git/">Git</a></span>
        <span title="author" class="post-info">纪秀峰</span>
      </div>
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          //var disqus_developer = 1;
          var disqus_identifier = "/blog/git拾遗/";
          var disqus_url = "http://jixiuf.github.io/blog/git拾遗/";
          var disqus_shortname = 'jixiuf';
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        <div class="ds-thread"></div>
        <script type="text/javascript">
          var duoshuoQuery = {short_name:'jixiuf'};
          (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = 'http://static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
          || document.getElementsByTagName('body')[0]).appendChild(ds);
          })();
        </script>
      </section>
      <script src="http://code.jquery.com/jquery-latest.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="/media/js/main.js"></script>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.x (<a href="http://orgmode.org">Org mode</a> 8.x)</p>
        <p>
          Copyright &copy; 2012 - <span id="footerYear"></span> <a href="mailto:jixiuf &lt;at&gt; gmail &lt;dot&gt; com">纪秀峰</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/kelvinh/org-page" target="_blank">org-page</a>
          <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
      </div>
    </div>

  </body>
</html>
